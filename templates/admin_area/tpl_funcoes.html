{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
/* CSS específico do módulo Funções - se necessário */
.panel-container_estatistica {
    display: none !important; /* COR: Oculta o painel de estatísticas */
}
</style>
{% endblock %}
    
{% block title %}
    {% if modo_criacao %}
        Criar Função
    {% elif modo_edicao_crud %}
        Editar Função
    {% elif modo_visualizacao_crud %}
        Visualizar Função
    {% else %}
        Cadastro de Funções
    {% endif %}
{% endblock %}

<!-- === BLOCO DASHBOARD === -->
{% block icone_dashboard %}fas fa-briefcase{% endblock %}
{% block nome_modulo_dashboard %}Funções{% endblock %}
{% block url_retornar_dashboard %}{% url 'app_igreja:admin_area' %}{% endblock %}
{% block url_criar_novo_dashboard %}{% url 'app_igreja:criar_funcao' %}{% endblock %}
{% block nome_modulo_lista_dashboard %}Funções{% endblock %}

<!-- === BLOCO ESTATÍSTICAS DASHBOARD === -->
{% block estatisticas_dashboard %}
<!-- PAINEL DE ESTATÍSTICAS OCULTO PARA FUNÇÕES -->
{% endblock %}

<!-- === BLOCO BUSCA DASHBOARD === -->
{% block busca_dashboard %}
<form method="get" class="busca-campos">
    <div class="campo-busca">
        <label for="busca_nome">Nome da Função</label>
        <input type="text" id="busca_nome" name="busca_nome" 
               value="{{ request.GET.busca_nome }}" 
               placeholder="Digite o nome...">
    </div>
    <button type="submit" class="cont_busca_btnbusca">
        <i class="fas fa-search"></i>
    </button>
</form>
{% endblock %}

<!-- === BLOCO COLUNAS CABEÇALHO DASHBOARD === -->
{% block colunas_cabecalho_dashboard %}
<th width="10%">ID</th>
<th width="70%">Nome da Função</th>
<th width="20%">Status</th>
{% endblock %}

<!-- === BLOCO LINHAS TABELA DASHBOARD === -->
{% block linhas_tabela_dashboard %}
    {% for funcao in page_obj %}
    <tr>
        {% block linha_completa_dashboard %}
        <td>
            <i class="fas fa-ellipsis-v" 
               onclick="selecionarRegistroDashboard({{ funcao.FUN_id }})"
               style="cursor: pointer; padding: 8px; border-radius: 4px; transition: all 0.3s ease; font-size: 16px;"
               onmouseover="this.style.backgroundColor='#e9ecef'" 
               onmouseout="this.style.backgroundColor='transparent'"></i>
        </td>
        <td>{{ funcao.FUN_id }}</td>
        <td>
            <div>
                <div class="mb-2">
                    <strong>{{ funcao.FUN_nome_funcao }}</strong>
                </div>
                <!-- Botões de ação -->
                <div class="botoes-acao" id="acoes_{{ funcao.FUN_id }}" style="display: none;">
                    <div class="d-flex gap-2 justify-content-start align-items-center">
                        <a href="{% url 'app_igreja:detalhar_funcao' funcao.FUN_id %}" class="btn btn-info btn-sm d-flex align-items-center">
                            <i class="fas fa-eye me-1"></i>Consultar
                        </a>
                        <a href="{% url 'app_igreja:editar_funcao' funcao.FUN_id %}" class="btn btn-warning btn-sm d-flex align-items-center">
                            <i class="fas fa-edit me-1"></i>Editar
                        </a>
                        <a href="{% url 'app_igreja:excluir_funcao' funcao.FUN_id %}" class="btn btn-danger btn-sm d-flex align-items-center">
                            <i class="fas fa-trash me-1"></i>Excluir
                        </a>
                    </div>
                </div>
            </div>
        </td>
        <td>
            <span class="badge bg-success">Ativo</span>
        </td>
        {% endblock %}
    </tr>
    {% empty %}
    <tr>
        <td colspan="4" class="text-center text-muted">
            <i class="fas fa-briefcase fa-2x mb-2"></i>
            <br>
            Nenhuma função encontrada.
        </td>
    </tr>
    {% endfor %}
{% endblock %}

<!-- === BLOCO MENSAGEM VAZIO DASHBOARD === -->
{% block mensagem_vazio_dashboard %}Clique em "Nova Função" para adicionar a primeira função.{% endblock %}

{% block conteudo_detalhe %}
{% if acao == 'consultar' %}
<!-- MODO CONSULTA -->
<div class="row">
    <div class="col-md-6">
        <p><strong>Nome da Função:</strong> {{ funcao.FUN_nome_funcao|default:"Não informado" }}</p>
    </div>
    <div class="col-md-6">
        <p><strong>ID:</strong> {{ funcao.FUN_id }}</p>
    </div>
</div>

{% elif acao == 'incluir' or acao == 'editar' %}
<!-- MODO INCLUSÃO/EDIÇÃO -->
<form method="post" id="detail-form" onsubmit="return lockFormButtons(this)">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
    {% endif %}

    <div class="row">
        <div class="col-md-12">
            <div class="mb-3">
                <label for="{{ form.FUN_nome_funcao.id_for_label }}" class="form-label">Nome da Função:</label>
                {{ form.FUN_nome_funcao }}
                {% if form.FUN_nome_funcao.errors %}
                    <div class="text-danger small mt-1">
                        {{ form.FUN_nome_funcao.errors.0 }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</form>

{% elif acao == 'excluir' %}
<!-- MODO EXCLUSÃO -->
<div class="row">
    <div class="col-md-6">
        <p><strong>ID:</strong> {{ funcao.FUN_id }}</p>
        <p><strong>Nome:</strong> {{ funcao.FUN_nome_funcao }}</p>
    </div>
</div>

<form method="post" id="detail-form" onsubmit="return lockFormButtons(this)">
    {% csrf_token %}
</form>
{% endif %}
{% endblock %}
